#!/bin/bash

# Prints the deployment environment corresponding to the given k8s namespace
function deployment_env() {
    local namespace
    namespace=$(kubectl config view --minify --output 'jsonpath={..namespace}')
    
    case "${namespace}" in
    *dev*)
        echo -n "development"
        return 0
        ;;
    *prod*)
        echo -n "production"
        return 0
        ;;
    *qa2*)
        echo -n "qa2"
        return 0
        ;;
    *qa*)
        echo -n "qa"
        return 0
        ;;
    *sandbox*)
        echo -n "sandbox"
        return 0
        ;;
    *staging*)
        echo -n "staging"
        return 0
        ;;
    *)
        # Local k8s installations seldom have k8s namespaces, so
        # try matching the name of the current context
        [[ "$(kubectl config current-context)" =~ docker|desktop ]] && echo "local" && return 0
        return 1
        ;;
    esac
}

deployment_env || ( echo "Could not determine deployment environment" 2>&1 && exit 1 )